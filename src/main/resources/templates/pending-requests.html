<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
    layout:decorate="~{shared/layout}">

<head>
    <title>Appointment Requests</title>
    <style>
        .request-card {
            border-left: 4px solid #007bff;
            margin-bottom: 15px;
        }

        .request-card.approved {
            border-left-color: #28a745;
        }

        .request-card.denied {
            border-left-color: #dc3545;
        }

        .request-card.pending {
            border-left-color: #ffc107;
        }
    </style>
</head>

<body>
    <div layout:fragment="content" class="content-wrapper">
        <!-- Content Header (Page header) -->
        <div class="content-header">
            <div class="container-fluid">
                <div class="row mb-2">
                    <div class="col-sm-6">
                        <h1 class="m-0">Appointment Requests</h1>
                    </div>
                    <div class="col-sm-6">
                        <ol class="breadcrumb float-sm-right">
                            <li class="breadcrumb-item"><a href="/">Home</a></li>
                            <li class="breadcrumb-item active">Requests</li>
                        </ol>
                    </div>
                </div>
            </div>
        </div>

        <!-- Main content -->
        <section class="content">
            <div class="container-fluid">
                <div class="row">
                    <div class="col-md-12">
                        <!-- Filter tabs -->
                        <div class="card">
                            <div class="card-header p-2">
                                <ul class="nav nav-pills">
                                    <li class="nav-item">
                                        <a class="nav-link active" href="#pending" data-toggle="tab">
                                            Pending
                                        </a>
                                    </li>
                                    <li class="nav-item">
                                        <a class="nav-link" href="#approved" data-toggle="tab">
                                            Approved
                                        </a>
                                    </li>
                                    <li class="nav-item">
                                        <a class="nav-link" href="#denied" data-toggle="tab">
                                            Denied
                                        </a>
                                    </li>
                                </ul>
                            </div>
                            <div class="card-body">
                                <div class="tab-content">
                                    <!-- Pending Requests -->
                                    <div class="tab-pane fade show active" id="pending">
                                        <div th:if="${#lists.isEmpty(requests)}" class="alert alert-info">
                                            No requests found
                                        </div>
                                        <div th:each="request : ${requests}" th:if="${request.status == 'PENDING'}"
                                            class="card request-card pending">
                                            <div class="card-header">
                                                <h5><span th:text="${request.patientName}"></span> - <span
                                                        th:text="${request.requestId}"></span></h5>
                                            </div>
                                            <div class="card-body">
                                                <div class="row">
                                                    <div class="col-md-6">
                                                        <p><strong>Date:</strong> <span
                                                                th:text="${request.appointmentDate}"></span></p>
                                                        <p><strong>Time:</strong> <span
                                                                th:text="${request.appointmentTime}"></span></p>
                                                    </div>
                                                    <div class="col-md-6">
                                                        <p><strong>Reason:</strong></p>
                                                        <p th:text="${request.reason}"></p>
                                                    </div>
                                                </div>
                                                <div class="form-row mt-3">
                                                    <div class="col-md-4">
                                                        <form method="post"
                                                            th:action="@{/appointment-requests/approve/{id}(id=${request.id})}"
                                                            style="display: inline;">
                                                            <button type="submit"
                                                                class="btn btn-success btn-sm btn-block">
                                                                <i class="fas fa-check"></i> Approve
                                                            </button>
                                                        </form>
                                                    </div>
                                                    <div class="col-md-4">
                                                        <a th:href="@{/appointment-requests/view/{id}(id=${request.id})}"
                                                            class="btn btn-info btn-sm btn-block">
                                                            <i class="fas fa-eye"></i> View
                                                        </a>
                                                    </div>
                                                    <div class="col-md-4">
                                                        <form method="post"
                                                            th:action="@{/appointment-requests/deny/{id}(id=${request.id})}"
                                                            style="display: inline;">
                                                            <input type="hidden" name="denialReason" value="Denied by doctor">
                                                            <button type="submit"
                                                                class="btn btn-danger btn-sm btn-block"
                                                                onclick="return confirm('Are you sure you want to deny this request?');">
                                                                <i class="fas fa-times"></i> Deny
                                                            </button>
                                                        </form>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Approved Requests -->
                                    <div class="tab-pane fade" id="approved">
                                        <div th:if="${#lists.isEmpty(requests)}" class="alert alert-info">
                                            No approved requests
                                        </div>
                                        <div th:each="request : ${requests}" th:if="${request.status == 'APPROVED'}"
                                            class="card request-card approved">
                                            <div class="card-header">
                                                <h5><span th:text="${request.patientName}"></span> - <span
                                                        th:text="${request.requestId}"></span></h5>
                                            </div>
                                            <div class="card-body">
                                                <p><strong>Date:</strong> <span
                                                        th:text="${request.appointmentDate}"></span></p>
                                                <p><strong>Time:</strong> <span
                                                        th:text="${request.appointmentTime}"></span></p>
                                                <p><strong>Reason:</strong> <span th:text="${request.reason}"></span>
                                                </p>
                                                <span class="badge badge-success">Approved on <span
                                                        th:text="${request.updatedAt}"></span></span>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Denied Requests -->
                                    <div class="tab-pane fade" id="denied">
                                        <div th:if="${#lists.isEmpty(requests)}" class="alert alert-info">
                                            No denied requests
                                        </div>
                                        <div th:each="request : ${requests}" th:if="${request.status == 'DENIED'}"
                                            class="card request-card denied">
                                            <div class="card-header">
                                                <h5><span th:text="${request.patientName}"></span> - <span
                                                        th:text="${request.requestId}"></span></h5>
                                            </div>
                                            <div class="card-body">
                                                <p><strong>Date:</strong> <span
                                                        th:text="${request.appointmentDate}"></span></p>
                                                <p><strong>Time:</strong> <span
                                                        th:text="${request.appointmentTime}"></span></p>
                                                <p><strong>Reason:</strong> <span th:text="${request.reason}"></span>
                                                </p>
                                                <p><strong>Denial Reason:</strong></p>
                                                <p class="text-danger" th:text="${request.denialReason}"></p>
                                                <span class="badge badge-danger">Denied on <span
                                                        th:text="${request.updatedAt}"></span></span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </div>
</body>

</html>